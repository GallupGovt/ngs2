---
title: "Group Innovation under Competition and Uncertanity - Cycle 4 Results"
author: "Pablo Diego-Rosell, PhD  - Gallup"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  html_document:
    number_sections: yes
    theme: united
    toc: yes
  pdf_document:
    toc: yes
  word_document:
    toc: yes
---

```{r run_scripts, include=F}
# run scripts in order
library("RCurl")
library("bridgesampling")
library("rstanarm")

source("functions.R")
source("prep.R")

nIter <- 100
nChains <- 3
options(mc.cores = parallel::detectCores())
summarize <- function (file_name) {
  load (file=file_name)
  print(summary(fittedLmer, pars="beta", digits = 3))
  print(plot(fittedLmer, pars="beta"))
  print(plot(fittedLmer, "trace", pars="beta"))
}
formula.h15.1<-as.formula("conformity~tolerance+competition+pressure+grmot1+framing+complexity+timeUncertainty+support+centralization+leaderWeight+density+(1|group)")
fittedGlmer <- stan_glmer(formula.h15.1, data=factorialGroup, family=gaussian(link = "identity"), iter=3, chains=1)
ndim<-length(fittedGlmer$covmat[1,])-2
priorSD <- 0.05
h15.0 <- normal(location = c(0.0, rep(0, ndim)), scale = c(priorSD, rep(2.5,ndim)), autoscale=FALSE)
h15.1 <- normal(location = c(-0.1, rep(0, ndim)), scale = c(priorSD, rep(2.5,ndim)), autoscale=FALSE)
bayesLmer<-function(formula, priors, dataset = factorial) {
  set.seed(12345)
  formulatext <- gsub("formula.", "",deparse(substitute(formula)))
  priorstext <- deparse(substitute(priors))
  label<-paste(formulatext, "_", priorstext, sep="")
  diagnostic<-paste("diagnostic_",formulatext, "_", priorstext, ".csv", sep="")
  fittedLmer<- stan_glmer(formula,
                           data=dataset,
                           family = gaussian(link = "identity"),
                           prior = priors,
                           prior_intercept = normal(0, 2.5),
                           chains = nChains, 
                           iter = nIter,
                           seed = 12345,
                           diagnostic_file = diagnostic)
  fittedLmer$call$diagnostic_file <- diagnostic
  save (fittedLmer, file = paste("bayesLmer_",label, sep=""))
  bridge_priors <- bridge_sampler(fittedLmer, silent=TRUE)
  save (bridge_priors, file = paste("bridge_",label, sep=""))
  return(bridge_priors)
}
bridge_15.0 <- bayesLmer(formula.h15.1, h15.0, factorialGroup)
summarize ("bayesLmer_h15.1_h15.0")
```

<br />
<br />
